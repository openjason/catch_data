C++停止服务及其依赖项
2015年08月21日 09:31:38 天狼_125 阅读数：271 标签： windows 操作系统 编程
概要
服务控制管理器 (SCM) 不会尝试停止服务，如果其他正在运行的服务依赖于它。若要以编程方式停止此类服务，必须首先枚举并停止其依赖项。本文的"更多信息"部分中的示例代码演示如何使用 EnumDependentServices() API 来停止该服务。
详细信息
时到 scm 服务数据库中注册服务，还建立及其依赖项。SCM 可以保证依赖项将自动启动的服务本身开始之前。

可以通过将 SERVICE_CONTROL_STOP 请求发送到服务通过 SCM ControlService() API 通过停止服务。如果 SCM 收到 SERVICE_CONTROL_STOP 请求服务时，它指示服务停止通过转发 stop 代码服务的ServiceMain()功能才能正常工作。但是，如果 SCM 确定其他正在运行的服务都依赖于指定的服务，它将不会转发停止请求。相反，它将返回错误代码 1051 (ERROR_DEPENDENT_SERVICES_RUNNING) ―"停止控制已发送给其他正在运行的服务依赖的服务。"
示例代码
下面的代码实现一个StopService()函数，还可以尝试停止指定的服务相关性。